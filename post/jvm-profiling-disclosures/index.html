<!doctype html>











































<html
  class="not-ready lg:text-base"
  style="--bg: #fff"
  lang="en-us"
>
  <head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta
    name="viewport"
    content="width=device-width, initial-scale=1, shrink-to-fit=no"
  />
  <meta name="google-site-verification" content="G_45CPokMqh_LLvc0RdyiWWVQq9G0nvUhl53pa2ra-g" />

  
  <title>JVM Profiling Disclosures - Kiran Gangadharan</title>

  
  <meta name="theme-color" />

  
  
  
  
  <meta name="description" content="Well, I’ve never actually given importance to the term ”profiling” till
a few days ago. The real deal was that I was just too lazy to actually
run a profiler and then to try interpret the stats and hopefully find
the bottleneck in the code. So to avoid all this hassle, I tried to be
careful while writing code to make sure I don’t leave any open doors for
memory leaks or poor CPU utilization." />
  <meta name="author" content="Kiran Gangadharan" />
  

  
  
  
  
  
  
  <link rel="preload stylesheet" as="style" href="http://kirang.in/main.min.css" />

  
  
  
  
  
  <link rel="preload" as="image" href="http://kirang.in/theme.svg" />

  
  
  
  
  

  
  
  <link rel="preload" as="image" href="http://kirang.in/twitter.svg" />
  
  <link rel="preload" as="image" href="http://kirang.in/github.svg" />
  
  <link rel="preload" as="image" href="http://kirang.in/linkedin.svg" />
  
  <link rel="preload" as="image" href="http://kirang.in/rss.svg" />
  
  <link rel="preload" as="image" href="http://kirang.in/goodreads.svg" />
  
  

  
  
  <script
    defer
    src="http://kirang.in/highlight.min.js"
    onload="hljs.initHighlightingOnLoad();"
  ></script>
  

  
  
  

  
  <link rel="icon" href="http://kirang.in/favicon_32x32.png" />
  <link rel="apple-touch-icon" href="http://kirang.in/apple-touch-icon.png" />

  
  <meta name="generator" content="Hugo 0.146.5">

  
  
  
  
  
  
  <meta itemprop="name" content="JVM Profiling Disclosures">
  <meta itemprop="description" content="Well, I’ve never actually given importance to the term ”profiling” till a few days ago. The real deal was that I was just too lazy to actually run a profiler and then to try interpret the stats and hopefully find the bottleneck in the code. So to avoid all this hassle, I tried to be careful while writing code to make sure I don’t leave any open doors for memory leaks or poor CPU utilization.">
  <meta itemprop="datePublished" content="2013-05-22T02:55:00+05:30">
  <meta itemprop="dateModified" content="2013-05-22T02:55:00+05:30">
  <meta itemprop="wordCount" content="726">
  <meta itemprop="keywords" content="Java,Jvm,Performance">
  
  <meta property="og:url" content="http://kirang.in/post/jvm-profiling-disclosures/">
  <meta property="og:site_name" content="Kiran Gangadharan">
  <meta property="og:title" content="JVM Profiling Disclosures">
  <meta property="og:description" content="Well, I’ve never actually given importance to the term ”profiling” till a few days ago. The real deal was that I was just too lazy to actually run a profiler and then to try interpret the stats and hopefully find the bottleneck in the code. So to avoid all this hassle, I tried to be careful while writing code to make sure I don’t leave any open doors for memory leaks or poor CPU utilization.">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="post">
    <meta property="article:published_time" content="2013-05-22T02:55:00+05:30">
    <meta property="article:modified_time" content="2013-05-22T02:55:00+05:30">
    <meta property="article:tag" content="Java">
    <meta property="article:tag" content="Jvm">
    <meta property="article:tag" content="Performance">

  
  
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="JVM Profiling Disclosures">
  <meta name="twitter:description" content="Well, I’ve never actually given importance to the term ”profiling” till a few days ago. The real deal was that I was just too lazy to actually run a profiler and then to try interpret the stats and hopefully find the bottleneck in the code. So to avoid all this hassle, I tried to be careful while writing code to make sure I don’t leave any open doors for memory leaks or poor CPU utilization.">

  
  
  
  <link rel="canonical" href="http://kirang.in/post/jvm-profiling-disclosures/" />
  
  
</head>

  <body class="text-black duration-200 ease-out dark:text-white">
    <header class="mx-auto flex h-[4.5rem] max-w-3xl px-8 lg:justify-center">
  <div class="relative z-50 mr-auto flex items-center">
    <a
      class="-translate-x-[1px] -translate-y-[1px] text-2xl font-semibold"
      href="http://kirang.in/"
      >Kiran Gangadharan</a
    >
    <div
      class="btn-dark text-[0] ml-4 h-6 w-6 shrink-0 cursor-pointer [background:url(./theme.svg)_left_center/cover_no-repeat] dark:invert dark:[background-position:right]"
      role="button"
      aria-label="Dark"
    ></div>
  </div>

  <div
    class="btn-menu relative z-50 -mr-8 flex h-[4.5rem] w-[5rem] shrink-0 cursor-pointer flex-col items-center justify-center gap-2.5 lg:hidden"
    role="button"
    aria-label="Menu"
  ></div>

  

  <script>
    
    const htmlClass = document.documentElement.classList;
    setTimeout(() => {
      htmlClass.remove('not-ready');
    }, 10);

    
    const btnMenu = document.querySelector('.btn-menu');
    btnMenu.addEventListener('click', () => {
      htmlClass.toggle('open');
    });

    
    const metaTheme = document.querySelector('meta[name="theme-color"]');
    const lightBg = '#fff'.replace(/"/g, '');
    const setDark = (isDark) => {
      metaTheme.setAttribute('content', isDark ? '#000' : lightBg);
      htmlClass[isDark ? 'add' : 'remove']('dark');
      localStorage.setItem('dark', isDark);
    };

    
    const darkScheme = window.matchMedia('(prefers-color-scheme: dark)');
    if (htmlClass.contains('dark')) {
      setDark(true);
    } else {
      const darkVal = localStorage.getItem('dark');
      setDark(darkVal ? darkVal === 'true' : darkScheme.matches);
    }

    
    darkScheme.addEventListener('change', (event) => {
      setDark(event.matches);
    });

    
    const btnDark = document.querySelector('.btn-dark');
    btnDark.addEventListener('click', () => {
      setDark(localStorage.getItem('dark') !== 'true');
    });
  </script>

  <div
    class="nav-wrapper fixed inset-x-0 top-full z-40 flex h-full select-none flex-col justify-center pb-16 duration-200 dark:bg-black lg:static lg:h-auto lg:flex-row lg:!bg-transparent lg:pb-0 lg:transition-none"
  >
    
    
    <nav class="lg:ml-12 lg:flex lg:flex-row lg:items-center lg:space-x-6">
      
      <a
        class="block text-center text-2xl leading-[5rem] lg:text-base lg:font-normal"
        href="/about/"
        >About</a
      >
      
    </nav>
    

    
    <nav
      class="mt-12 flex justify-center space-x-10 dark:invert lg:ml-12 lg:mt-0 lg:items-center lg:space-x-6"
    >
      
      <a
        class="h-8 w-8 text-[0] [background:var(--url)_center_center/cover_no-repeat] lg:h-6 lg:w-6"
        style="--url: url(./twitter.svg)"
        href="https://twitter.com/kirang89"
        target="_blank"
        rel="me"
      >
        twitter
      </a>
      
      <a
        class="h-8 w-8 text-[0] [background:var(--url)_center_center/cover_no-repeat] lg:h-6 lg:w-6"
        style="--url: url(./github.svg)"
        href="https://github.com/kirang89"
        target="_blank"
        rel="me"
      >
        github
      </a>
      
      <a
        class="h-8 w-8 text-[0] [background:var(--url)_center_center/cover_no-repeat] lg:h-6 lg:w-6"
        style="--url: url(./linkedin.svg)"
        href="https://linkedin.com/in/kirang89"
        target="_blank"
        rel="me"
      >
        linkedin
      </a>
      
      <a
        class="h-8 w-8 text-[0] [background:var(--url)_center_center/cover_no-repeat] lg:h-6 lg:w-6"
        style="--url: url(./rss.svg)"
        href="http://kirang.in/index.xml"
        target="_blank"
        rel="alternate"
      >
        rss
      </a>
      
      <a
        class="h-8 w-8 text-[0] [background:var(--url)_center_center/cover_no-repeat] lg:h-6 lg:w-6"
        style="--url: url(./goodreads.svg)"
        href="https://goodreads.com/kirang"
        target="_blank"
        rel="me"
      >
        goodreads
      </a>
      
    </nav>
    
  </div>
</header>


    <main
      class="prose prose-neutral relative mx-auto min-h-[calc(100%-9rem)] max-w-3xl px-8 pb-16 pt-12 dark:prose-invert"
    >
      

<article>
  <header class="mb-16">
    <h1 class="!my-0 pb-2.5">JVM Profiling Disclosures</h1>

    
    <div class="text-sm antialiased opacity-60">
      
      <time>May 22, 2013</time>
      
      
      
      
      <span class="mx-1">&middot;</span>
      <span>Kiran Gangadharan</span>
      
    </div>
    
  </header>

  <section><p>Well, I’ve never actually given importance to the term ”profiling” till
a few days ago. The real deal was that I was just too lazy to actually
run a profiler and then to try interpret the stats and hopefully find
the bottleneck in the code. So to avoid all this hassle, I tried to be
careful while writing code to make sure I don’t leave any open doors for
memory leaks or poor CPU utilization.</p>
<p>But a few days back, I stumbled into a performance issue in my code at
work, leaving both me and my project lead puzzled about the culprit.
Atlast desperation lead us to setup YourKit profiling in our server to
have a peak under the hood of the JVM. And in the process, we happened
to learn some new terms and functionalities of the profiler and I must
say that I’m slowly beginning to like the idea of profiling code. I was
really surprised at what we could learn about our code just by looking
at the profiler stats. So here below, I’ve merged in some of our
learnings along the whole process.</p>
<h3 id="jvm-memory-structure">JVM Memory Structure</h3>
<p>It’s important to first understand the structure of the JVM memory
itself. Simply put:</p>
<pre tabindex="0"><code>JVM Memory = Heap Memory + Non-Heap Memory + Other

Other: (JVM code itself, JVM internal structures, loaded profiler agent code and data, etc.)
</code></pre><h3 id="profiling-terms">Profiling Terms</h3>
<p>Next, lets look at a few terms you need to know in order to make some
sense out of all those weird graphs.</p>
<ul>
<li><em>Heap Memory</em> - Stores Java objects</li>
<li><em>Non-Heap memory</em> - Stores per-class structures and other meta-data</li>
<li><em>Stack Memory</em> - Java only stores primitives on the stack. Stack
values only exist within the scope in which they were created. Java
objects are created on the heap, and only references (which in turn
are primitives) are passed around on the stack.</li>
<li><em>Allocated Memory</em> - All memory that is allocated by the JVM</li>
<li><em>Used Memory</em> - Amount of memory that is actually in use</li>
<li><em>Eden</em> - Objects that are newly created reside here</li>
<li><em>S1(Survivor Space 1) or S2</em> - All objects that survive a GC cycle
go here</li>
<li><em>Young Generation</em> - Eden + S1 + S2 section of Heap memory</li>
<li><em>Old Gen Space</em> - Objects that survive a fixed number of GC cycles
go here</li>
<li><em>Shallow Size(object)</em> - Amount of allocated memory to store the
object</li>
<li><em>Retained Size(object)</em> - Shallow size of object under
consideration + Shallow size of other objects that can be directly
or indirectly accessed from this object</li>
</ul>
<h3 id="things-to-watch-out-for-while-profiling">Things to watch out for while profiling</h3>
<ul>
<li>In a typical application there will be less variation inside the Old
Gen space.</li>
<li>If the Old Gen space grows linearly with time even after the GC
cycle, it would lead to a <code>OutOfMemoryError</code>. This occurs mainly due
to JVM memory space depletion (Java Heap, Native Heap, etc.). This
might be a indication of a memory leak inside the code.</li>
<li>The <code>OutOfMemoryError</code> mainly occurs due to the following:
<ul>
<li>Lack of understanding of current JVM utilization</li>
<li>Inappropriate JVM GC policy used. (Monitor JVM GC closely.
Enable verbose GC option and analyse the data)
Lack of performance and load testing</li>
</ul>
</li>
</ul>
<p>From the above, you probably should understand most of the important
stats, when you look into your profiler output next time. Now comes the
important question:</p>
<h3 id="how-do-i-generally-findprevent-bottlenecks-in-my-code">How do I generally find/prevent bottlenecks in my code</h3>
<p>I’ve tried to provide a few ideas below:</p>
<ul>
<li>Understand your application’s memory footprint</li>
<li>Provide Connection Timeouts for any sort of communication API that
you use.</li>
<li>Cache data wherever possible to avoid more I/O operations on disk</li>
<li>Monitor your threads closely to make sure there aren’t any
bottlenecks or, well Deadlocks (gulp)</li>
<li>Monitor Network Latencies. They are the hidden culprits of many
performance problems.</li>
<li>Implement application logging. This will help you to internally
monitor the performance issues and hotspots in your code.</li>
<li>Use Client JVM for development and Server JVM in production. Most
people ignore this change. Even I did so. That was mainly because I
never knew the difference between the JVM’s. The Server JVM does
heavy optimization to your code to increase performance and reduce
memory and CPU footprints, in production.</li>
<li>Increase JVM Heap by specifying <code>-Xms</code> and <code>-Xmx</code> while running your
application</li>
<li>Analyse what’s happening under the hood in the heap, using <code>jmap</code>
and <code>jhat</code> (Haven’t really tried this out)</li>
</ul>
<p>This should help out.</p>
</section>

  
  
  <footer class="mt-12 flex flex-wrap">
     
    <a
      class="mb-1.5 mr-1.5 rounded-lg bg-black/[3%] px-5 py-1.5 no-underline dark:bg-white/[8%]"
      href="http://kirang.in/tags/java"
      >java</a
    >
     
    <a
      class="mb-1.5 mr-1.5 rounded-lg bg-black/[3%] px-5 py-1.5 no-underline dark:bg-white/[8%]"
      href="http://kirang.in/tags/jvm"
      >jvm</a
    >
     
    <a
      class="mb-1.5 mr-1.5 rounded-lg bg-black/[3%] px-5 py-1.5 no-underline dark:bg-white/[8%]"
      href="http://kirang.in/tags/performance"
      >performance</a
    >
    
  </footer>
  

  
  
  
  
  <nav class="mt-24 flex rounded-lg bg-black/[3%] text-lg dark:bg-white/[8%]">
    
    <a
      class="flex w-1/2 items-center rounded-l-md p-6 pr-3 font-semibold no-underline hover:bg-black/[2%] dark:hover:bg-white/[3%]"
      href="http://kirang.in/post/what-is-python-month/"
      ><span class="mr-1.5">←</span><span>What is Python Month?</span></a
    >
    
    
    <a
      class="ml-auto flex w-1/2 items-center justify-end rounded-r-md p-6 pl-3 font-semibold no-underline hover:bg-black/[2%] dark:hover:bg-white/[3%]"
      href="http://kirang.in/post/installing-pylibmc-in-ubuntu/"
      ><span>Installing pylibmc in ubuntu</span><span class="ml-1.5">→</span></a
    >
    
  </nav>
  
  

  
  

  
  

  


  
  <div class="giscus mt-24"></div>
  <script
    src="https://giscus.app/client.js"
    data-repo="kirang89/kirang.in"
    data-repo-id="MDEwOlJlcG9zaXRvcnkxNjU2NzY2MTY="
    data-category="General"
    data-category-id="DIC_kwDOCeAGSM4Cfo4J"
    data-mapping="title"
    data-strict="1"
    data-reactions-enabled="1"
    data-emit-metadata="0"
    data-input-position="top"
    data-theme="light"
    data-lang="en"
    data-loading="lazy"
    crossorigin="anonymous"
    async
  ></script>
  
</article>


    </main>

    <footer
  class="opaco mx-auto flex h-[4.5rem] max-w-3xl items-center px-8 text-[0.9em] opacity-60"
>
  <div class="mr-auto">
    &copy; 2025
    <a class="link" href="http://kirang.in/">Kiran Gangadharan</a>
  </div>
  <a class="link mx-6" href="https://gohugo.io/" rel="noopener" target="_blank"
    >Powered by Hugo️️</a
  >️
  <a
    class="link"
    href="https://github.com/nanxiaobei/hugo-paper"
    rel="noopener"
    target="_blank"
    >✎ Paper</a
  >
</footer>

  </body>
</html>
